<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>æ­æ´²å°é¹¿æ—…éŠåŠ©æ‰‹</title>
  <style>
    :root {
      --primary-pink: #ffb7b2;
      --soft-blue: #b2e2f2;
      --warm-orange: #ffdac1;
      --leaf-green: #e2f0cb;
      --bg-color: #fffafb;
      --text-gray: #5d5d5d;
    }

    body {
      font-family: "PingFang TC", sans-serif;
      margin: 0; background: var(--bg-color); color: var(--text-gray);
      height: 100vh; display: flex; flex-direction: column; overflow: hidden;
    }

    /* é ‚éƒ¨æ¨™é¡Œ */
    .header { text-align: center; padding: 15px; font-weight: bold; font-size: 18px; background: #fff; color: var(--primary-pink); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

    /* é é¢å®¹å™¨ */
    .content-area { flex: 1; position: relative; overflow: hidden; }
    .page {
      position: absolute; top: 0; width: 100%; height: 100%; 
      overflow-y: auto; padding: 20px; box-sizing: border-box;
      transition: transform 0.3s ease; transform: translateX(100%);
    }
    .page.active { transform: translateX(0); }
    .page.prev { transform: translateX(-100%); }

    /* å¯æ„›å¡ç‰‡ */
    .card { background: #fff; border-radius: 20px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
    h2 { font-size: 18px; color: var(--primary-pink); margin-top: 0; border-left: 4px solid var(--primary-pink); padding-left: 10px; }

    /* è¡¨å–®å…ƒä»¶ */
    label { font-size: 13px; color: #999; margin-bottom: 5px; display: block; }
    input, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1.5px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 16px; }
    button { width: 100%; padding: 15px; border: none; border-radius: 15px; font-size: 17px; font-weight: bold; cursor: pointer; }
    .btn-save { background: var(--primary-pink); color: white; margin-top: 10px; }

    /* è¡Œç¨‹å°ˆç”¨æ¨£å¼ */
    .itinerary-item { border-left: 2px dashed var(--soft-blue); margin-left: 10px; padding-left: 20px; position: relative; margin-bottom: 20px; }
    .itinerary-item::before { content: 'ğŸ“'; position: absolute; left: -12px; top: 0; background: var(--bg-color); font-size: 14px; }
    .time-tag { font-size: 12px; color: var(--soft-blue); font-weight: bold; }
    .loc-name { font-weight: bold; font-size: 16px; margin: 4px 0; }

    /* åº•éƒ¨å°è¦½åˆ— */
    .tab-bar {
      display: flex; background: #fff; height: 70px; border-top: 1px solid #eee;
      padding-bottom: env(safe-area-inset-bottom);
    }
    .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 12px; color: #bbb; }
    .tab-item.active { color: var(--primary-pink); }
    .tab-icon { font-size: 20px; margin-bottom: 4px; }
  </style>
</head>
<body>

  <div class="header" id="page-title">ğŸ“ æ–°å¢è¨˜å¸³</div>

  <div class="content-area">
    <div id="page-add" class="page active">
      <div class="card">
        <label>æ—¥æœŸ</label>
        <input type="date" id="addDate">
        <label>é …ç›®</label>
        <input type="text" id="addItem" placeholder="åƒä»€éº¼æˆ–è²·ä»€éº¼ï¼Ÿ">
        <div style="display:flex; gap:10px;">
          <div style="flex:1"><label>é‡‘é¡(EUR)</label><input type="number" id="addAmount" placeholder="0.00"></div>
          <div style="flex:1"><label>åˆ†é¡</label>
            <select id="addCategory">
              <option>åƒ ğŸ•</option><option>äº¤é€š ğŸ«</option><option>ä½å®¿ ğŸ¨</option><option>è³¼ç‰© ğŸ›ï¸</option>
            </select>
          </div>
        </div>
        <button class="btn-save" onclick="submitExpense()">å„²å­˜é€™ç­†èŠ±è²»</button>
        <div id="status-msg" style="text-align:center; margin-top:10px; font-size:12px; color:var(--primary-pink)"></div>
      </div>
    </div>

    <div id="page-list" class="page">
      <div id="history-content">è¼‰å…¥ä¸­...</div>
    </div>

    <div id="page-travel" class="page">
      <div id="itinerary-content">æ­£åœ¨ç¿»é–±è¡Œç¨‹è¡¨...</div>
    </div>
  </div>

  <div class="tab-bar">
    <div class="tab-item active" onclick="switchTab(0, 'ğŸ“ æ–°å¢è¨˜å¸³')">
      <span class="tab-icon">âœï¸</span><span>è¨˜å¸³</span>
    </div>
    <div class="tab-item" onclick="switchTab(1, 'ğŸ“… è¨˜å¸³æ­·å²')">
      <span class="tab-icon">ğŸ’°</span><span>ç´€éŒ„</span>
    </div>
    <div class="tab-item" onclick="switchTab(2, 'âœˆï¸ è¡Œç¨‹è¦åŠƒ')">
      <span class="tab-icon">ğŸ—ºï¸</span><span>è¡Œç¨‹</span>
    </div>
  </div>

<script>
  const SPREADSHEET_ID = "1-bY7b7pZpFN8ANpTkRKSzQ2FARgy0KYPkEMaqU7CVIk";
  const GAS_URL = "ä½ çš„_GAS_ç¶²å€"; 
  const EUR_TO_TWD = 34.5;

  document.getElementById('addDate').valueAsDate = new Date();

  function switchTab(index, title) {
    const pages = document.querySelectorAll('.page');
    const tabs = document.querySelectorAll('.tab-item');
    document.getElementById('page-title').innerText = title;
    
    pages.forEach((p, i) => {
      p.classList.remove('active', 'prev');
      if(i === index) p.classList.add('active');
      else if(i < index) p.classList.add('prev');
    });
    
    tabs.forEach((t, i) => t.classList.toggle('active', i === index));
    
    if(index === 1) loadData('æ­æ´²è¨˜å¸³è¡Œç¨‹/è¨˜å¸³', renderHistory);
    if(index === 2) loadData('è¡Œç¨‹', renderItinerary);
  }

  async function loadData(sheetName, callback) {
    const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
    try {
      const res = await fetch(url, { cache: "no-store" });
      const text = await res.text();
      callback(parseCSV(text));
    } catch (e) { console.error("è®€å–å¤±æ•—", e); }
  }

  function parseCSV(text) {
    const lines = text.split("\n").filter(l => l.trim());
    const header = lines[0].split(",").map(h => h.replace(/"/g, "").trim());
    return lines.slice(1).map(line => {
      const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      const obj = {};
      header.forEach((h, i) => obj[h] = cols[i]?.replace(/"/g, "").trim());
      return obj;
    });
  }

  function renderHistory(data) {
    const container = document.getElementById('history-content');
    let total = 0;
    const html = data.reverse().map(r => {
      const amt = Number(r["é‡‘é¡(EUR)"] || r["EUR"] || 0);
      total += amt;
      return `<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
        <div><b>${r["é …ç›®"]}</b><br><small>${r["æ—¥æœŸ"]} Â· ${r["åˆ†é¡"]}</small></div>
        <div style="color:var(--primary-pink); font-weight:bold;">â‚¬${amt}</div>
      </div>`;
    }).join("");
    container.innerHTML = `<div class="card" style="background:var(--warm-orange); color:#fff; text-align:center;">
      <small>ç¸½æ”¯å‡ºä¼°è¨ˆ</small><br><b style="font-size:20px;">â‚¬${total.toFixed(2)} / NT$${Math.round(total*EUR_TO_TWD)}</b>
    </div>` + html;
  }

  function renderItinerary(data) {
    const container = document.getElementById('itinerary-content');
    container.innerHTML = data.map(r => `
      <div class="itinerary-item">
        <div class="time-tag">${r["æ™‚é–“"] || 'å…¨å¤©'}</div>
        <div class="loc-name">${r["åœ°é»"]}</div>
        <div style="font-size:14px; color:#777;">${r["æ´»å‹•å…§å®¹"] || ''}</div>
        <div style="font-size:12px; color:#bbb; margin-top:4px;">${r["å‚™è¨»"] || ''}</div>
      </div>
    `).join("") || "è¡Œç¨‹è¡¨æ˜¯ç©ºçš„å”·ï¼";
  }

  async function submitExpense() {
    // ... èˆ‡ä¹‹å‰çš„ submit åŠŸèƒ½ç›¸åŒ ...
  }
</script>
</body>
</html>
