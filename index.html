<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>æ­æ´²è¡Œç¨‹åŠ©æ‰‹ ğŸ—ºï¸</title>
  <style>
    :root {
      --primary-pink: #ffb7b2;
      --soft-blue: #b2e2f2;
      --warm-orange: #ffdac1;
      --bg-color: #fffafb;
      --text-gray: #4d4d4d;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: var(--bg-color); }
    body { display: flex; flex-direction: column; font-family: -apple-system, "PingFang TC", "Helvetica Neue", sans-serif; }

    /* ä¸Šæ–¹æ¨™é¡Œåˆ— */
    .header-title {
      background: #fff;
      padding: env(safe-area-inset-top) 20px 15px;
      text-align: center;
      font-weight: bold;
      font-size: 20px;
      color: var(--text-gray);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      z-index: 100;
    }

    /* Day åˆ†é å°è¦½åˆ— */
    .day-nav {
      display: flex; gap: 10px; overflow-x: auto; padding: 15px; 
      background: #fff; border-bottom: 1px solid #f0f0f0; flex-shrink: 0;
      scrollbar-width: none;
    }
    .day-nav::-webkit-scrollbar { display: none; }
    .day-btn {
      flex-shrink: 0; padding: 10px 20px; border-radius: 15px; background: #f8f8f8;
      color: #999; font-size: 15px; font-weight: bold; cursor: pointer; border: 1px solid #eee;
      transition: all 0.2s ease;
    }
    .day-btn.active { 
      background: var(--primary-pink); color: #fff; 
      border-color: var(--primary-pink); 
      box-shadow: 0 4px 12px rgba(255,183,178,0.4); 
    }

    /* å…§å®¹é¡¯ç¤ºå€ */
    .itinerary-container { flex: 1; overflow-y: auto; padding: 10px 20px 40px; }
    .day-content-group { display: none; }
    .day-content-group.active { display: block; animation: fadeIn 0.4s ease; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    /* è¡Œç¨‹å¡ç‰‡æ¨£å¼ */
    .card { background: #fff; border-radius: 22px; padding: 20px; margin-bottom: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.04); border: 1px solid rgba(255,183,178,0.1); }
    .itinerary-card { border-left: 6px solid var(--soft-blue); }
    .itinerary-title { font-size: 18px; font-weight: 800; color: var(--text-gray); margin-bottom: 6px; }
    .time-tag { font-size: 13px; color: #5da9e1; font-weight: bold; margin-bottom: 6px; display: block; }
    .content-text { font-size: 15px; color: #777; white-space: pre-wrap; line-height: 1.6; margin-top: 8px; }
    
    .map-btn { 
      display: inline-flex; align-items: center; justify-content: center;
      background: #f0f7ff; color: #007aff; 
      padding: 12px 18px; border-radius: 14px; 
      font-size: 14px; text-decoration: none; 
      margin-top: 15px; font-weight: bold;
      border: 1px solid rgba(0,122,255,0.1);
      width: 100%;
    }
    .map-btn:active { background: #e0eeff; transform: scale(0.98); }

    .loading { text-align: center; padding: 50px; color: #bbb; font-size: 14px; }
  </style>
</head>
<body>

  <div class="header-title">My Travel Itinerary</div>

  <div id="day-nav-container" class="day-nav"></div>

  <div id="itinerary-content" class="itinerary-container">
    <div class="loading">æ­£åœ¨é€£ç·šè‡³ Google Sheet...</div>
  </div>

<script>
  // è«‹å¡«å…¥ä½ çš„ Spreadsheet ID
  const SPREADSHEET_ID = "1-bY7b7pZpFN8ANpTkRKSzQ2FARgy0KYPkEMaqU7CVIk";

  // åˆå§‹åŒ–è‡ªå‹•è¼‰å…¥
  window.onload = () => loadItineraryData();

  async function loadItineraryData() {
    const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent('è¡Œç¨‹')}`;
    try {
      const res = await fetch(url, { cache: "no-store" });
      const text = await res.text();
      renderItinerary(parseCSV(text));
    } catch (e) {
      console.error(e);
      document.getElementById('itinerary-content').innerHTML = '<div class="loading">é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯</div>';
    }
  }

  function parseCSV(text) {
    const lines = text.split("\n").filter(l => l.trim());
    if (!lines.length) return [];
    const header = lines[0].split(",").map(h => h.replace(/"/g, "").trim());
    return lines.slice(1).map(line => {
      const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      const obj = {};
      header.forEach((h, i) => obj[h] = cols[i]?.replace(/"/g, "").trim());
      return obj;
    });
  }

  function renderItinerary(data) {
    const container = document.getElementById('itinerary-content');
    const navContainer = document.getElementById('day-nav-container');
    let html = "";
    let navHtml = "";
    let dayGroups = {};

    // æ•´ç†è³‡æ–™æŒ‰ Day åˆ†é¡
    data.forEach(r => {
      const day = r["Day"] || "Day";
      if (!dayGroups[day]) dayGroups[day] = { date: r["æ—¥æœŸ"], items: [] };
      dayGroups[day].items.push(r);
    });

    const dayKeys = Object.keys(dayGroups);
    if (dayKeys.length === 0) {
      container.innerHTML = '<div class="loading">ç›®å‰æ²’æœ‰ä»»ä½•è¡Œç¨‹è³‡æ–™</div>';
      return;
    }

    dayKeys.forEach((day, index) => {
      // é ‚éƒ¨ Day æŒ‰éˆ•
      navHtml += `<button id="btn-${day}" class="day-btn ${index === 0 ? 'active' : ''}" onclick="showDayPage('${day}')">${day}</button>`;

      // è©² Day çš„è¡Œç¨‹å€å¡Š
      html += `<div id="content-${day}" class="day-content-group ${index === 0 ? 'active' : ''}">`;
      html += `<div style="color:var(--primary-pink); font-weight:bold; margin-bottom:20px; font-size:15px; text-align:center;">ğŸ—“ï¸ ${dayGroups[day].date || ''}</div>`;
      
      dayGroups[day].items.forEach(item => {
        // ç”Ÿæˆåœ°åœ–é€£çµ
        let mapLink = "";
        const mapVal = item["Google map"] ? item["Google map"].trim() : "";
        if (mapVal) {
          mapLink = mapVal.startsWith("http") ? mapVal : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(mapVal)}`;
        }

        html += `
          <div class="card itinerary-card">
            ${item["æ™‚é–“"] ? `<span class="time-tag">â° ${item["æ™‚é–“"]}</span>` : ''}
            <div class="itinerary-title">${item["æ¨™é¡Œ"] || "æœªå‘½åè¡Œç¨‹"}</div>
            ${item["å…§å®¹"] ? `<div class="content-text">${item["å…§å®¹"]}</div>` : ''}
            ${mapLink ? `<a href="${mapLink}" target="_blank" class="map-btn">ğŸ“ å‰å¾€ Google Map</a>` : ''}
          </div>`;
      });
      html += `</div>`;
    });

    navContainer.innerHTML = navHtml;
    container.innerHTML = html;
  }

  function showDayPage(dayId) {
    // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
    document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`btn-${dayId}`).classList.add('active');

    // åˆ‡æ›å…§å®¹é¡¯ç¤º
    document.querySelectorAll('.day-content-group').forEach(group => group.classList.remove('active'));
    document.getElementById(`content-${dayId}`).classList.add('active');
    
    // ç½®é ‚
    document.getElementById('itinerary-content').scrollTop = 0;
  }
</script>
</body>
</html>
