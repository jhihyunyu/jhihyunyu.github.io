<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>2026å¾·å¥§æ·å°Uæ—…è¡Œåœ˜ âœˆï¸</title>
  <style>
    :root {
      --primary-pink: #ffb7b2;
      --soft-blue: #b2e2f2;
      --warm-orange: #ffdac1;
      --bg-color: #fffafb;
      --text-gray: #4d4d4d;
      --danger-red: #ff6b6b;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: var(--bg-color); }
    body { display: flex; flex-direction: column; font-family: -apple-system, "PingFang TC", sans-serif; }

    .header-title {
      background: #fff; padding: env(safe-area-inset-top) 20px 15px;
      text-align: center; font-weight: 900; font-size: 22px; color: var(--text-gray);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 100;
    }

    /* æ–°å¢è¡Œç¨‹è¡¨å–®æ¨£å¼ */
    .admin-panel { background: #fff; padding: 15px; border-bottom: 1.5px solid #eee; display: none; }
    .admin-panel input, .admin-panel textarea { width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
    .btn-group { display: flex; gap: 10px; }
    .btn-add-submit { background: var(--primary-pink); color: white; border: none; padding: 10px; border-radius: 8px; flex: 1; font-weight: bold; }
    .btn-toggle-admin { background: var(--text-gray); color: white; border: none; padding: 5px 15px; border-radius: 20px; font-size: 12px; margin: 10px auto; display: block; }

    .day-nav { display: flex; gap: 10px; overflow-x: auto; padding: 15px; background: #fff; border-bottom: 1px solid #f0f0f0; flex-shrink: 0; scrollbar-width: none; }
    .day-nav::-webkit-scrollbar { display: none; }
    .day-btn { flex-shrink: 0; padding: 10px 20px; border-radius: 15px; background: #f8f8f8; color: #999; font-size: 15px; font-weight: bold; cursor: pointer; border: 1px solid #eee; }
    .day-btn.active { background: var(--primary-pink); color: #fff; box-shadow: 0 4px 12px rgba(255,183,178,0.4); }

    .itinerary-container { flex: 1; overflow-y: auto; padding: 10px 20px 40px; }
    .day-content-group { display: none; }
    .day-content-group.active { display: block; animation: fadeIn 0.4s ease; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    .card { background: #fff; border-radius: 22px; padding: 20px; margin-bottom: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.04); border: 1px solid rgba(255,183,178,0.1); position: relative; }
    .itinerary-card { border-left: 6px solid var(--soft-blue); }
    .itinerary-title { font-size: 18px; font-weight: 800; color: var(--text-gray); margin-bottom: 6px; }
    .time-tag { font-size: 13px; color: #5da9e1; font-weight: bold; margin-bottom: 6px; display: block; }
    .content-text { font-size: 15px; color: #777; white-space: pre-wrap; line-height: 1.6; margin-top: 8px; }
    
    .map-btn { display: inline-flex; align-items: center; justify-content: center; background: #f0f7ff; color: #007aff; padding: 10px; border-radius: 12px; font-size: 14px; text-decoration: none; margin-top: 15px; font-weight: bold; width: 100%; border: 1px solid rgba(0,122,255,0.1); }
    
    .btn-delete { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #ccc; font-size: 18px; cursor: pointer; }
    .btn-delete:hover { color: var(--danger-red); }

    .loading { text-align: center; padding: 50px; color: #bbb; font-size: 14px; }
  </style>
</head>
<body>

  <div class="header-title">2026å¾·å¥§æ·å°Uæ—…è¡Œåœ˜</div>

  <button class="btn-toggle-admin" onclick="toggleAdmin()">âš™ï¸ ç®¡ç†è¡Œç¨‹</button>
  
  <div id="admin-panel" class="admin-panel">
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 8px;">
      <input type="text" id="newDay" placeholder="Day (å¦‚: Day1)">
      <input type="text" id="newDate" placeholder="æ—¥æœŸ (å¦‚: 10/24)">
    </div>
    <input type="text" id="newTime" placeholder="æ™‚é–“ (å¦‚: 09:00)">
    <input type="text" id="newTitle" placeholder="æ¨™é¡Œ">
    <textarea id="newContent" placeholder="å…§å®¹å…§å®¹..." rows="2"></textarea>
    <input type="text" id="newMap" placeholder="Google Map é—œéµå­—æˆ–é€£çµ">
    <button class="btn-add-submit" id="btnAdd" onclick="addItinerary()">ğŸš€ æäº¤æ–°å¢è¡Œç¨‹</button>
  </div>

  <div id="day-nav-container" class="day-nav"></div>
  <div id="itinerary-content" class="itinerary-container"><div class="loading">è¼‰å…¥ä¸­...</div></div>

<script>
  const SPREADSHEET_ID = "1-bY7b7pZpFN8ANpTkRKSzQ2FARgy0KYPkEMaqU7CVIk";
  const GAS_URL = "ä½ çš„_GAS_éƒ¨ç½²ç¶²å€"; // <--- è«‹å‹™å¿…å¡«å…¥ä½ çš„ GAS ç¶²å€

  window.onload = () => loadItineraryData();

  function toggleAdmin() {
    const panel = document.getElementById('admin-panel');
    panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
  }

  async function loadItineraryData() {
    const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent('è¡Œç¨‹')}`;
    try {
      const res = await fetch(url, { cache: "no-store" });
      const text = await res.text();
      renderItinerary(parseCSV(text));
    } catch (e) { console.error(e); }
  }

  function parseCSV(text) {
    const lines = text.split("\n").filter(l => l.trim());
    if (!lines.length) return [];
    const header = lines[0].split(",").map(h => h.replace(/"/g, "").trim());
    return lines.slice(1).map(line => {
      const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      const obj = {};
      header.forEach((h, i) => obj[h] = cols[i]?.replace(/"/g, "").trim());
      return obj;
    });
  }

  function renderItinerary(data) {
    const container = document.getElementById('itinerary-content');
    const navContainer = document.getElementById('day-nav-container');
    let html = ""; let navHtml = ""; let dayGroups = {};

    data.forEach(r => {
      const day = r["Day"] || "Day";
      if (!dayGroups[day]) dayGroups[day] = { date: r["æ—¥æœŸ"], items: [] };
      dayGroups[day].items.push(r);
    });

    const dayKeys = Object.keys(dayGroups);
    dayKeys.forEach((day, index) => {
      navHtml += `<button id="btn-${day}" class="day-btn ${index === 0 ? 'active' : ''}" onclick="showDayPage('${day}')">${day}</button>`;
      html += `<div id="content-${day}" class="day-content-group ${index === 0 ? 'active' : ''}">`;
      html += `<div style="color:var(--primary-pink); font-weight:bold; margin-bottom:20px; font-size:15px; text-align:center;">ğŸ—“ï¸ ${dayGroups[day].date || ''}</div>`;
      
      dayGroups[day].items.forEach(item => {
        let mapLink = "";
        const mapVal = item["Google map"] ? item["Google map"].trim() : "";
        if (mapVal) mapLink = mapVal.startsWith("http") ? mapVal : `https://www.google.com/maps/search/${encodeURIComponent(mapVal)}`;

        html += `
          <div class="card itinerary-card">
            <button class="btn-delete" onclick="deleteItinerary('${item["æ¨™é¡Œ"]}')">Ã—</button>
            ${item["æ™‚é–“"] ? `<span class="time-tag">â° ${item["æ™‚é–“"]}</span>` : ''}
            <div class="itinerary-title">${item["æ¨™é¡Œ"] || "æœªå‘½å"}</div>
            ${item["å…§å®¹"] ? `<div class="content-text">${item["å…§å®¹"]}</div>` : ''}
            ${mapLink ? `<a href="${mapLink}" target="_blank" class="map-btn">ğŸ“ åœ°åœ–å°èˆª</a>` : ''}
          </div>`;
      });
      html += `</div>`;
    });
    navContainer.innerHTML = navHtml;
    container.innerHTML = html;
  }

  async function addItinerary() {
    const btn = document.getElementById('btnAdd');
    btn.innerText = "â³ è™•ç†ä¸­...";
    btn.disabled = true;

    const params = new URLSearchParams();
    params.append('action', 'add');
    params.append('day', document.getElementById('newDay').value);
    params.append('date', document.getElementById('newDate').value);
    params.append('time', document.getElementById('newTime').value);
    params.append('title', document.getElementById('newTitle').value);
    params.append('content', document.getElementById('newContent').value);
    params.append('map', document.getElementById('newMap').value);

    await fetch(GAS_URL, { method: "POST", mode: "no-cors", body: params });
    alert("æ–°å¢æˆåŠŸï¼è³‡æ–™æ›´æ–°ç´„éœ€å¹¾ç§’é˜ã€‚");
    location.reload();
  }

  async function deleteItinerary(title) {
    if (!confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${title}ã€å—ï¼Ÿ`)) return;
    
    const params = new URLSearchParams();
    params.append('action', 'delete');
    params.append('title', title);

    await fetch(GAS_URL, { method: "POST", mode: "no-cors", body: params });
    alert("åˆªé™¤è¦æ±‚å·²é€å‡ºï¼");
    location.reload();
  }

  function showDayPage(dayId) {
    document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`btn-${dayId}`).classList.add('active');
    document.querySelectorAll('.day-content-group').forEach(group => group.classList.remove('active'));
    document.getElementById(`content-${dayId}`).classList.add('active');
    document.getElementById('itinerary-content').scrollTop = 0;
  }
</script>
</body>
</html>
